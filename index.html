<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ADATA TV PRO - Ultimate Player</title>
    
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body { background: #050505; color: white; font-family: 'Cairo', sans-serif; margin: 0; }
        .channel-item { background: #111; padding: 18px; margin: 10px 15px; border-radius: 12px; border: 1px solid #222; cursor: pointer; display: flex; align-items: center; transition: 0.3s; }
        .channel-item:hover { border-color: #ff9500; background: #1a1a1a; }
        #video-overlay { position: fixed; inset: 0; background: #000; z-index: 10000; display: none; }
        .video-js { width: 100% !important; height: 100% !important; }
        .back-btn { position: absolute; top: 20px; left: 20px; z-index: 11000; background: rgba(255,0,0,0.8); color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div id="ui-content">
        <div class="p-4 bg-zinc-900 shadow-2xl text-center font-bold text-orange-500 text-xl border-b border-orange-500/20">ADATA TV PRO</div>
        <div id="list" class="py-4 pb-20">
            <div class="text-center p-10 text-gray-500 animate-pulse">جاري جلب القنوات من Google Sheets...</div>
        </div>
    </div>

    <div id="video-overlay">
        <div class="back-btn" onclick="closePlayer()">إغلاق X</div>
        <video id="my-video" class="video-js vjs-big-play-centered vjs-theme-city" controls preload="auto" width="auto" height="auto"></video>
    </div>

    <script>
        // رابط الشيت الخاص بك (تأكد أنه متاح للجميع)
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/14Z-3UCmBxB9fkk0N29JiLYB7XeBPBvKHy8Ai_oL3dOM/gviz/tq?tqx=out:csv';
        
        // إعداد المشغل
        let player = videojs('my-video');

        async function fetchChannels() {
            try {
                const response = await fetch(SHEET_URL);
                const csvText = await response.text();
                const rows = csvText.split('\n').slice(1);
                
                let html = '';
                rows.forEach(row => {
                    const columns = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if(columns.length >= 2) {
                        const name = columns[0].replace(/"/g, '');
                        const url = columns[1].replace(/"/g, '');
                        html += `
                            <div class="channel-item" onclick="openPlayer('${url.trim()}')">
                                <div class="w-10 h-10 bg-orange-500/10 rounded-full flex items-center justify-center ml-4">
                                    <span class="text-orange-500">▶</span>
                                </div>
                                <span class="text-lg font-medium">${name}</span>
                            </div>`;
                    }
                });
                document.getElementById('list').innerHTML = html;
            } catch (err) {
                document.getElementById('list').innerHTML = '<div class="text-center text-red-500">فشل تحميل القنوات</div>';
            }
        }

        function openPlayer(url) {
            document.getElementById('video-overlay').style.display = 'block';
            
            // تحديد نوع الملف تلقائياً
            let type = 'application/x-mpegURL'; // لروابط m3u8 و hls
            if (url.toLowerCase().includes('.mp4')) type = 'video/mp4';
            if (url.toLowerCase().includes('.ts')) type = 'video/mp2t';
            if (url.toLowerCase().includes('.mkv')) type = 'video/webm';

            player.src({ src: url, type: type });
            player.play();
        }

        function closePlayer() {
            player.pause();
            document.getElementById('video-overlay').style.display = 'none';
        }

        window.onload = fetchChannels;
    </script>
</body>
</html>
