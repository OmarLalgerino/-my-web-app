<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ADATA TV Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        
        :root {
            --primary: #ff9500;
            --surface: #050505;
            --card: #111111;
            --border: rgba(255, 255, 255, 0.08);
            --text-main: #ffffff;
        }

        body.light-mode {
            --surface: #f3f4f6;
            --card: #ffffff;
            --border: rgba(0, 0, 0, 0.1);
            --text-main: #111111;
        }

        body {
            background-color: var(--surface);
            color: var(--text-main);
            font-family: 'Cairo', sans-serif;
            margin: 0;
            overflow: hidden;
            height: 100vh;
        }

        /* Video Player Styling */
        #video-container { position: absolute; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; }
        .video-js { width: 100vw !important; height: 100vh !important; }

        .zoom-normal video { object-fit: contain !important; }
        .zoom-fill video { object-fit: fill !important; }
        .zoom-crop video { object-fit: cover !important; }

        #splash-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; transition: 0.5s; }
        #app-wrapper { display: flex; height: 100vh; width: 100vw; visibility: hidden; }

        .sidebar { width: 100%; background: var(--surface); display: flex; flex-direction: column; z-index: 50; }
        .main-content { position: fixed; inset: 0; background: #000; z-index: 100; display: none; }
        .is-playing .main-content { display: flex; }

        .channel-card {
            background: var(--card);
            border-radius: 12px;
            padding: 12px;
            margin: 6px 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }
        .channel-card:active { transform: scale(0.96); background: rgba(255, 149, 0, 0.1); }

        .overlay-controls {
            position: absolute;
            top: 20px;
            left: 15px;
            right: 15px;
            z-index: 210;
            display: flex;
            justify-content: space-between;
        }
        
        .btn-action {
            background: rgba(0,0,0,0.6);
            padding: 8px 14px;
            border-radius: 40px;
            color: white;
            font-size: 12px;
            backdrop-filter: blur(8px);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .search-box {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin: 0 12px 12px 12px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-box input { background: transparent; border: none; color: var(--text-main); width: 100%; outline: none; font-size: 14px; }
        
        .tab-item { cursor: pointer; padding: 12px 0; text-align: center; flex: 1; font-weight: bold; font-size: 0.85rem; color: gray; border-bottom: 2px solid transparent; transition: 0.3s; }
        .tab-item.active { color: var(--primary); border-bottom-color: var(--primary); }

        .brand-logo { height: 32px; width: auto; object-fit: contain; }

        /* Double Tap Feedback */
        .seek-feedback {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            width: 100px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            opacity: 0;
            z-index: 205;
            transition: opacity 0.2s;
        }
        .seek-feedback i { font-size: 2rem; margin-bottom: 5px; }
        .seek-left { left: 10%; }
        .seek-right { right: 10%; }
        .show-seek { opacity: 1 !important; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <img src="https://upload.wikimedia.org/wikipedia/ar/thumb/6/66/ADATA_logo.svg/960px-ADATA_logo.svg.png" class="brand-logo animate-pulse">
    </div>

    <div id="app-wrapper">
        <aside class="sidebar">
            <div class="p-5 flex items-center justify-between">
                <img src="https://upload.wikimedia.org/wikipedia/ar/thumb/6/66/ADATA_logo.svg/960px-ADATA_logo.svg.png" class="brand-logo">
                <div id="theme-btn" class="p-2 cursor-pointer text-orange-500"><i class="fas fa-moon"></i></div>
            </div>

            <div class="search-box">
                <i class="fas fa-search text-gray-500"></i>
                <input type="text" id="search-input" placeholder="ابحث...">
            </div>

            <div class="flex px-4 border-b border-[var(--border)]">
                <div class="tab-item active" onclick="UIManager.switchTab('live', this)">مباشر</div>
                <div class="tab-item" onclick="UIManager.switchTab('vod', this)">أفلام</div>
                <div class="tab-item" onclick="UIManager.switchTab('series', this)">مسلسلات</div>
                <div class="tab-item" onclick="UIManager.switchTab('anime', this)">أنمي</div>
            </div>

            <div id="list" class="flex-1 overflow-y-auto pt-2 pb-6"></div>
        </aside>

        <main class="main-content" id="player-screen">
            <div class="overlay-controls">
                <div class="btn-action" onclick="UIManager.close()"> <i class="fas fa-chevron-right"></i> رجوع </div>
                <div class="flex gap-2">
                    <div class="btn-action bg-orange-600" id="external-vlc-btn"> <i class="fas fa-external-link-alt"></i> VLC </div>
                    <div class="btn-action" id="zoom-btn"> <i class="fas fa-expand-arrows-alt"></i> <span id="zoom-label">افتراضي</span> </div>
                </div>
            </div>

            <div id="seek-left-feedback" class="seek-feedback seek-left text-white">
                <i class="fas fa-backward"></i>
                <span class="text-xs">10 ثوانِ</span>
            </div>
            <div id="seek-right-feedback" class="seek-feedback seek-right text-white">
                <i class="fas fa-forward"></i>
                <span class="text-xs">10 ثوانِ</span>
            </div>

            <div id="video-container" class="zoom-normal"></div>
        </main>
    </div>

    <script>
        const API_LINKS = {
            live: 'https://docs.google.com/spreadsheets/d/14Z-3UCmBxB9fkk0N29JiLYB7XeBPBvKHy8Ai_oL3dOM/gviz/tq?tqx=out:csv',
            vod: 'https://docs.google.com/spreadsheets/d/1tSIcjUZuRphgmcS0YNUvT83980OWLH7KoNpmUQ8UfWA/gviz/tq?tqx=out:csv',
            anime: 'https://docs.google.com/spreadsheets/d/1LNdY3vajY5vMM7zGl4ipEcz-96gPs7QI-QgaS4LwP94/gviz/tq?tqx=out:csv',
            series: 'https://docs.google.com/spreadsheets/d/1tugkYcVuDf0bIo6bAOZzo5JJoA0YnE8OUxXK_50gbmQ/gviz/tq?tqx=out:csv'
        };

        const UIManager = {
            allData: [],
            player: null,
            currentUrl: '',
            zoomIndex: 0,
            zoomModes: [{c:'zoom-normal',l:'افتراضي'}, {c:'zoom-fill',l:'ملء'}, {c:'zoom-crop',l:'قص'}],
            lastClickTime: 0,

            async init() {
                await this.loadCategory('live');
                this.setupGlobalEvents();
                setTimeout(() => {
                    document.getElementById('splash-screen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('splash-screen').style.display = 'none';
                        document.getElementById('app-wrapper').style.visibility = 'visible';
                    }, 500);
                }, 1200);
            },

            async loadCategory(type) {
                const listEl = document.getElementById('list');
                listEl.innerHTML = '<div class="p-10 text-center opacity-50 text-sm">جاري التحميل...</div>';
                try {
                    const res = await fetch(API_LINKS[type]);
                    const text = await res.text();
                    this.allData = text.split('\n').slice(1).map(row => {
                        const p = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                        return {
                            name: p[0]?.replace(/"/g, '').trim(),
                            url: p[1]?.replace(/"/g, '').trim(),
                            logo: p[2]?.replace(/"/g, '').trim() || "https://via.placeholder.com/50"
                        };
                    }).filter(i => i.url && i.name);
                    this.render(this.allData);
                } catch (e) {
                    listEl.innerHTML = '<div class="p-10 text-center text-red-500">فشل تحميل القنوات</div>';
                }
            },

            switchTab(type, el) {
                document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                el.classList.add('active');
                this.loadCategory(type);
            },

            render(data) {
                const list = document.getElementById('list');
                list.innerHTML = data.length === 0 ? '<div class="p-10 text-center opacity-30 text-sm">لا توجد نتائج</div>' :
                    data.map(item => `
                        <div class="channel-card" onclick="UIManager.play('${item.url}')">
                            <img src="${item.logo}" class="w-11 h-11 object-contain rounded bg-white/5 p-1" onerror="this.src='https://via.placeholder.com/50'">
                            <div class="flex-1 font-bold text-[13px] leading-tight">${item.name}</div>
                            <i class="fas fa-play-circle text-orange-500 text-lg"></i>
                        </div>
                    `).join('');
            },

            setupGlobalEvents() {
                document.getElementById('search-input').oninput = (e) => {
                    const term = e.target.value.toLowerCase();
                    const filtered = this.allData.filter(i => i.name.toLowerCase().includes(term));
                    this.render(filtered);
                };
                
                document.getElementById('zoom-btn').onclick = (e) => {
                    e.stopPropagation();
                    this.zoomIndex = (this.zoomIndex + 1) % this.zoomModes.length;
                    const mode = this.zoomModes[this.zoomIndex];
                    document.getElementById('video-container').className = mode.c;
                    document.getElementById('zoom-label').innerText = mode.l;
                };

                document.getElementById('external-vlc-btn').onclick = (e) => {
                    e.stopPropagation();
                    const intent = `intent://${this.currentUrl.replace(/^https?:\/\//, "")}#Intent;scheme=http;package=org.videolan.vlc;type=video/*;end`;
                    window.location.href = intent;
                };

                document.getElementById('theme-btn').onclick = () => document.body.classList.toggle('light-mode');
            },

            setupVideoInteraction() {
                const playerScreen = document.getElementById('player-screen');
                
                playerScreen.onclick = (e) => {
                    // تجاهل النقر إذا كان على الأزرار
                    if (e.target.closest('.btn-action') || e.target.closest('.vjs-control-bar')) return;

                    const currentTime = new Date().getTime();
                    const gap = currentTime - this.lastClickTime;

                    if (gap < 300) { // Double Tap detected
                        const rect = playerScreen.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        if (x > rect.width / 2) {
                            this.player.currentTime(this.player.currentTime() + 10);
                            this.showSeekFeedback('right');
                        } else {
                            this.player.currentTime(this.player.currentTime() - 10);
                            this.showSeekFeedback('left');
                        }
                    } else {
                        // Single Tap: Play/Pause
                        if (this.player.paused()) this.player.play(); else this.player.pause();
                    }
                    this.lastClickTime = currentTime;
                };
            },

            showSeekFeedback(direction) {
                const el = document.getElementById(`seek-${direction}-feedback`);
                el.classList.add('show-seek');
                setTimeout(() => el.classList.remove('show-seek'), 600);
            },

            play(url) {
                this.currentUrl = url;
                document.getElementById('app-wrapper').classList.add('is-playing');
                const container = document.getElementById('video-container');
                container.innerHTML = `<video id="main-video" class="video-js vjs-big-play-centered" controls playsinline></video>`;

                this.player = videojs('main-video', { 
                    autoplay: true, 
                    fluid: true,
                    html5: { hls: { overrideNative: true } }
                });

                // ضبط النوع ليدعم الروابط المباشرة و IPTV
                let type = "application/x-mpegURL";
                if (url.includes(".mp4")) type = "video/mp4";

                this.player.src({ src: url, type: type });
                this.setupVideoInteraction();
            },

            close() {
                document.getElementById('app-wrapper').classList.remove('is-playing');
                if(this.player) { this.player.dispose(); this.player = null; }
            }
        };

        window.onload = () => UIManager.init();
    </script>
</body>
</html>
