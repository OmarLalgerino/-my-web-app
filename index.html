<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ADATA TV - PRO</title>
    
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        
        body { 
            background-color: #050505; 
            color: white; 
            font-family: 'Cairo', sans-serif; 
            margin: 0; 
            padding: 0;
            overflow-x: hidden;
        }

        /* تنسيق بطاقة القناة */
        .channel-card { 
            background: linear-gradient(145deg, #1a1a1a, #0f0f0f);
            border-radius: 15px; 
            padding: 15px; 
            margin: 10px 15px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            border: 1px solid #222; 
            transition: 0.3s;
            cursor: pointer;
        }
        
        .channel-card:active { transform: scale(0.95); background: #222; }

        /* شاشة المشغل Full Screen */
        #player-screen { 
            position: fixed; 
            inset: 0; 
            background: #000; 
            z-index: 9999; 
            display: none; 
            flex-direction: column;
        }

        .close-btn { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            z-index: 10000; 
            background: rgba(255, 0, 0, 0.8); 
            color: white; 
            padding: 8px 20px; 
            border-radius: 50px; 
            font-weight: bold;
        }

        .video-js { width: 100% !important; height: 100% !important; }
    </style>
</head>
<body>

    <div id="main-ui">
        <div class="p-5 text-center border-b border-gray-800 bg-black sticky top-0 z-50">
            <h1 class="text-xl font-bold text-orange-500 tracking-widest">ADATA TV</h1>
            <p class="text-xs text-gray-400">جميع القنوات في مكان واحد</p>
        </div>

        <div id="list" class="pt-4 pb-20">
            <div class="text-center py-20 text-gray-500 animate-pulse">جاري جلب القنوات من Google Sheets...</div>
        </div>
    </div>

    <div id="player-screen">
        <div class="close-btn" onclick="stopVideo()"><i class="fas fa-times"></i> إغلاق</div>
        <div id="video-container" class="w-full h-full"></div>
    </div>

    <script>
        let player = null;
        // رابط ملفك الخاص على Google Sheets بصيغة CSV
        const csvUrl = 'https://docs.google.com/spreadsheets/d/14Z-3UCmBxB9fkk0N29JiLYB7XeBPBvKHy8Ai_oL3dOM/gviz/tq?tqx=out:csv';

        async function fetchChannels() {
            try {
                const response = await fetch(csvUrl);
                const data = await response.text();
                const rows = data.split('\n').slice(1); // تجاهل العنوان
                const listContainer = document.getElementById('list');
                listContainer.innerHTML = '';

                rows.forEach(row => {
                    // تقسيم البيانات مع مراعاة الفواصل داخل النصوص
                    const columns = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    const name = columns[0]?.replace(/"/g, '').trim();
                    const url = columns[1]?.replace(/"/g, '').trim();
                    const logo = columns[2]?.replace(/"/g, '').trim() || "https://via.placeholder.com/150/000000/FFFFFF?text=TV";

                    if (url && url.startsWith('http')) {
                        const card = document.createElement('div');
                        card.className = 'channel-card shadow-lg';
                        card.onclick = () => startVideo(url);
                        card.innerHTML = `
                            <img src="${logo}" class="w-14 h-14 rounded-lg object-contain bg-black border border-gray-700">
                            <div class="flex-1">
                                <div class="font-bold text-lg text-white">${name}</div>
                                <div class="text-xs text-green-500"><i class="fas fa-circle text-[8px] animate-pulse"></i> بث مباشر بجودة عالية</div>
                            </div>
                            <i class="fas fa-play-circle text-orange-500 text-2xl"></i>
                        `;
                        listContainer.appendChild(card);
                    }
                });
            } catch (error) {
                document.getElementById('list').innerHTML = `
                    <div class="text-center p-10 text-red-500">
                        <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
                        <p>فشل الاتصال بـ Google Sheets</p>
                    </div>`;
            }
        }

        function startVideo(url) {
            document.getElementById('player-screen').style.display = 'flex';
            const container = document.getElementById('video-container');
            
            // إضافة عنصر الفيديو ديناميكياً
            container.innerHTML = `
                <video id="v-player" class="video-js vjs-default-skin vjs-big-play-centered" 
                       controls playsinline preload="auto"></video>`;
            
            player = videojs('v-player', {
                autoplay: true,
                fluid: false,
                playbackRates: [0.5, 1, 1.5, 2]
            });

            // تحديد نوع البث تلقائياً (m3u8 أو mp4)
            const isM3U8 = url.includes('.m3u8') || url.includes('.ts');
            player.src({
                src: url,
                type: isM3U8 ? 'application/x-mpegURL' : 'video/mp4'
            });

            player.on('error', function() {
                alert('عذراً، هذا الرابط غير متاح حالياً أو لا يدعم المشغل.');
                stopVideo();
            });
        }

        function stopVideo() {
            if (player) {
                player.dispose();
                player = null;
            }
            document.getElementById('player-screen').style.display = 'none';
        }

        // تشغيل الجلب عند فتح الصفحة
        window.onload = fetchChannels;
    </script>
</body>
</html>
