<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ADATA - Live</title>
    
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "108ef22b-74b2-4e4a-bfcd-aa3e447b5616",
        });
      });
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Playfair+Display:ital,wght@1,700&display=swap');
        :root { --primary: #ff4d00; --surface: #050505; --card: #111111; --text: #ffffff; }
        body { background: var(--surface); color: var(--text); font-family: 'Cairo', sans-serif; margin: 0; overflow: hidden; height: 100vh; }
        .channel-card { background: var(--card); border-radius: 12px; padding: 12px; margin: 8px 12px; display: flex; align-items: center; gap: 15px; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .channel-logo { width: 50px; height: 50px; border-radius: 50%; object-fit: contain; background: #000; border: 1px solid var(--primary); }
        #player-screen { position: fixed; inset: 0; background: #000; z-index: 1000; display: none; }
        .video-js { width: 100vw !important; height: 100vh !important; }
        .back-btn { position: absolute; top: 20px; right: 20px; z-index: 1100; background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 30px; color: white; border: 1px solid rgba(255,255,255,0.2); }
    </style>
</head>
<body>

    <div id="main-ui" class="flex flex-col h-full">
        <div class="p-6 flex justify-between items-center border-b border-white/5">
            <h1 class="text-2xl font-black text-[#ff4d00]">ADATA</h1>
            <i class="fas fa-bell text-gray-400"></i>
        </div>
        
        <div id="list" class="flex-1 overflow-y-auto py-4">
            <div class="text-center p-10 text-gray-500">جاري تحميل القنوات...</div>
        </div>

        <div class="p-4 text-center border-t border-white/5">
            <span style="font-family: 'Playfair Display'; font-style: italic;" class="text-gray-500 text-sm">Omar L'Algerino</span>
        </div>
    </div>

    <div id="player-screen">
        <button class="back-btn" onclick="closePlayer()"><i class="fas fa-arrow-right"></i> رجوع</button>
        <div id="video-holder"></div>
    </div>

    <script>
        // روابط ملفات القنوات (تأكد أنها "منشورة على الويب" بصيغة CSV)
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/14Z-3UCmBxB9fkk0N29JiLYB7XeBPBvKHy8Ai_oL3dOM/gviz/tq?tqx=out:csv';

        let player;

        async function loadChannels() {
            try {
                const response = await fetch(CSV_URL);
                const data = await response.text();
                const rows = data.split('\n').slice(1);
                
                const listContainer = document.getElementById('list');
                listContainer.innerHTML = '';

                rows.forEach(row => {
                    const columns = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    const name = columns[0]?.replace(/"/g, '');
                    const url = columns[1]?.replace(/"/g, '');
                    const logo = columns[2]?.replace(/"/g, '') || 'https://via.placeholder.com/50';

                    if (name && url) {
                        const card = document.createElement('div');
                        card.className = 'channel-card';
                        card.onclick = () => playVideo(url);
                        card.innerHTML = `
                            <img src="${logo}" class="channel-logo">
                            <span class="font-bold">${name}</span>
                        `;
                        listContainer.appendChild(card);
                    }
                });
            } catch (error) {
                document.getElementById('list').innerHTML = '<div class="text-center text-red-500 p-10">فشل تحميل القنوات. تأكد من إعدادات الملف.</div>';
            }
        }

        function playVideo(url) {
            document.getElementById('player-screen').style.display = 'block';
            const holder = document.getElementById('video-holder');
            holder.innerHTML = `<video id="v-player" class="video-js vjs-default-skin" controls autoplay playsinline></video>`;
            
            player = videojs('v-player');
            player.src({ src: url, type: url.includes('m3u8') ? 'application/x-mpegURL' : 'video/mp4' });
        }

        function closePlayer() {
            if (player) {
                player.dispose();
            }
            document.getElementById('player-screen').style.display = 'none';
        }

        window.onload = loadChannels;
    </script>
</body>
</html>
