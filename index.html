<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ADATA Private Player</title>
    
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body { background-color: #000; color: #fff; font-family: 'Cairo', sans-serif; margin: 0; padding: 0; overflow: hidden; }
        
        /* تصميم قائمة القنوات */
        .channel-list { height: 100vh; overflow-y: auto; padding: 15px; }
        .card { background: #111; border: 1px solid #222; border-radius: 12px; padding: 12px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .card:active { background: #1a1a1a; }
        
        /* واجهة المشغل */
        #player-wrapper { position: fixed; inset: 0; background: #000; z-index: 100; display: none; flex-direction: column; }
        .vjs-default-skin { width: 100% !important; height: 100% !important; }
        .back-btn { position: absolute; top: 20px; right: 20px; z-index: 110; background: rgba(0,0,0,0.5); padding: 8px 15px; border-radius: 20px; font-size: 14px; }
    </style>
</head>
<body>

    <div id="main-ui" class="channel-list">
        <div class="flex items-center justify-between mb-6">
            <img src="https://upload.wikimedia.org/wikipedia/ar/thumb/6/66/ADATA_logo.svg/960px-ADATA_logo.svg.png" class="h-8">
            <span class="text-xs text-orange-500 font-bold">الوضع الخاص الآمن</span>
        </div>
        <div id="list-container"></div>
    </div>

    <div id="player-wrapper">
        <button class="back-btn" onclick="closePlayer()">✕ إغلاق</button>
        <div id="video-target" class="flex-1"></div>
    </div>

    <script>
        const API_URL = 'https://docs.google.com/spreadsheets/d/14Z-3UCmBxB9fkk0N29JiLYB7XeBPBvKHy8Ai_oL3dOM/gviz/tq?tqx=out:csv';
        let player = null;

        async function loadChannels() {
            try {
                const res = await fetch(API_URL);
                const text = await res.text();
                const rows = text.split('\n').slice(1);
                const channels = rows.map(r => {
                    const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return { name: c[0]?.replace(/"/g, ''), url: c[1]?.replace(/"/g, ''), logo: c[2]?.replace(/"/g, '') };
                }).filter(i => i.url);

                document.getElementById('list-container').innerHTML = channels.map(chan => `
                    <div class="card" onclick="openPlayer('${chan.url}')">
                        <img src="${chan.logo}" class="w-12 h-12 object-contain rounded bg-white/5" onerror="this.src='https://via.placeholder.com/50'">
                        <div class="font-bold text-sm">${chan.name}</div>
                        <div class="mr-auto text-orange-500"><i class="fas fa-play"></i></div>
                    </div>
                `).join('');
            } catch (e) { alert("خطأ في تحميل البيانات"); }
        }

        function openPlayer(url) {
            document.getElementById('player-wrapper').style.display = 'flex';
            const target = document.getElementById('video-target');
            target.innerHTML = `<video id="my-video" class="video-js vjs-big-play-centered" controls preload="auto" playsinline></video>`;

            player = videojs('my-video', {
                autoplay: true,
                fluid: true,
                sources: [{ src: url, type: 'application/x-mpegURL' }] // يدعم روابط IPTV و M3U8
            });

            // إخفاء الرابط برمجياً من الكونسول
            console.clear();
        }

        function closePlayer() {
            if (player) {
                player.dispose();
                player = null;
            }
            document.getElementById('player-wrapper').style.display = 'none';
        }

        window.onload = loadChannels;
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
</body>
</html>
